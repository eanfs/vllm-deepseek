version: '3.8'

services:
  deepseek-ocr2:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: deepseek-ocr2-vllm
    runtime: nvidia
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - MODEL_ID=deepseek-ai/DeepSeek-OCR-2
      - MODELSCOPE_CACHE=/models
      - GPU_MEMORY_UTILIZATION=0.9
      - MAX_MODEL_LEN=8192
      - HF_ENDPOINT=https://hf-mirror.com
      # 可选：使用镜像加速
      - HF_HUB_ENABLE_HF_TRANSFER=1
    ports:
      - "8000:8000"
    volumes:
      - ./models:/models
    shm_size: '16gb'
    restart: unless-stopped
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]